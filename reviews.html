<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reviews - Malaysian Street Food</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>

  <!-- ===================== NAVBAR ===================== -->
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="dishes.html">Dishes</a></li>
      <li><a href="featured.html">Featured</a></li>
      <li><a href="location.html">Locations</a></li>
      <li><a href="about.html">About Us</a></li>
      <li><a href="faq.html">FAQ</a></li>
      <li><a href="events.html">Events</a></li>
      <li><a class="active" href="reviews.html">Reviews</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>

  <!-- ===================== MAIN CONTENT ===================== -->
  <main>
    <div class="reviews-container">

      <!-- ===================== SECTION 1: WRITE A REVIEW ===================== -->
      <section class="section" id="write-review">
        <h2>Write a Review</h2>
        <div class="underline"></div>

        <div class="review-form">
          <label>Restaurant / Stall Name *</label>
          <input type="text" id="stallName" maxlength="60" placeholder="e.g., Ali Nasi Lemak">

          <label>Food / Dish Name *</label>
          <input type="text" id="foodName" maxlength="60" placeholder="e.g., Nasi Lemak">

          <label>Location *</label>
          <input type="text" id="location" maxlength="80" placeholder="e.g., Jalan Alor, KL">

          <label>Rating *</label>
          <div id="rating">
            <span class="star" data-val="1">‚òÖ</span>
            <span class="star" data-val="2">‚òÖ</span>
            <span class="star" data-val="3">‚òÖ</span>
            <span class="star" data-val="4">‚òÖ</span>
            <span class="star" data-val="5">‚òÖ</span>
          </div>
          <input type="hidden" id="ratingVal" value="0">

          <label>Your Review *</label>
          <textarea id="reviewText" maxlength="400" placeholder="Taste, price, queue, hygiene..."></textarea>

          <label>Upload Image (max 100KB)</label>
          <input type="file" id="photo" accept="image/*">
          <img id="preview" class="d-none" alt="preview">

          <div class="review-buttons">
            <button id="saveReview" class="button-primary">Save Review</button>
            <button id="clearForm" class="button-secondary">Clear</button>
          </div>
        </div>
      </section>

      <!-- ===================== SECTION 2: VIEW REVIEWS ===================== -->
      <section class="section" id="view-reviews">
        <h2>Recent Reviews</h2>
        <div class="underline"></div>

        <div id="reviews" class="reviews-grid">
          <!-- Reviews rendered here by JS -->
        </div>
      </section>

    </div>
  </main>

  <!-- ===================== FOOTER ===================== -->
  <footer>
    <p>¬© 2025 Malaysian Street Food. All rights reserved.</p>
  </footer>

  <!-- ===================== TOAST NOTIFICATION ===================== -->
  <div id="toast" class="toast">Review saved successfully!</div>

  <!-- ===================== LIGHTBOX MODAL ===================== -->
  <div id="imgModal" class="modal">
    <div class="modal-content">
      <span class="modal-close">√ó</span>
      <img id="modalImg" src="" alt="Review image">
    </div>
  </div>

  <!-- ===================== JAVASCRIPT ===================== -->
  <script>
    // -------------------- Draft autosave --------------------
    const draftKeys = ['stallName','foodName','location','reviewText'];
    draftKeys.forEach(id => {
      const val = sessionStorage.getItem('draft_' + id);
      if(val) $('#' + id).val(val);
      $('#' + id).on('input', function(){
        sessionStorage.setItem('draft_' + id, this.value);
      });
    });

    // -------------------- Star rating --------------------
    $('#rating .star').on('mouseenter click', function(){
      const val = Number($(this).data('val'));
      $('#ratingVal').val(val);
      $('#rating .star').each(function(){
        $(this).toggleClass('active', Number($(this).data('val')) <= val);
      });
    });

    // -------------------- Image preview --------------------
    $('#photo').on('change', function(){
      const file = this.files?.[0];
      if(!file){ 
        $('#preview').addClass('d-none').attr('src',''); 
        return; 
      }
      if(file.size > 102400){ 
        alert("Max 100KB"); 
        this.value=''; 
        $('#preview').addClass('d-none'); 
        return; 
      }
      const reader = new FileReader();
      reader.onload = e => { 
        $('#preview').attr('src', e.target.result).removeClass('d-none'); 
      };
      reader.readAsDataURL(file);
    });

    // -------------------- Render Reviews --------------------
    function renderReviews(){
      const list = JSON.parse(localStorage.getItem('reviews') || '[]');
      const container = $('#reviews').empty();
      if(!list.length){
        container.append('<p>No reviews yet!</p>');
        return;
      }
      list.forEach(r => {
        const stars = '‚òÖ'.repeat(r.rating) + '‚òÜ'.repeat(5 - r.rating);
        container.append(`
          <div class="review-card" data-id="${r.id}">
            <div><strong>${r.stall}</strong> - ${r.loc}</div>
            <div>üçΩÔ∏è ${r.food}</div>
            <div>${stars}</div>
            <p>${r.text}</p>
            ${r.img ? `<img src="${r.img}" class="thumb">` : ''}
            <div class="review-actions">
              <button class="button-delete">Delete</button>
            </div>
          </div>
        `);
      });
    }

    // -------------------- Save Review --------------------
    $('#saveReview').on('click', function(){
      const stall = $('#stallName').val().trim();
      const food = $('#foodName').val().trim();
      const loc = $('#location').val().trim();
      const rating = Number($('#ratingVal').val());
      const text = $('#reviewText').val().trim();
      const img = $('#preview').attr('src') || null;

      if(!stall || !food || !loc || !rating || !text){
        alert('Please fill all fields');
        return;
      }

      const review = { id: Date.now(), stall, food, loc, rating, text, img };
      const list = JSON.parse(localStorage.getItem('reviews') || '[]');
      list.push(review);
      localStorage.setItem('reviews', JSON.stringify(list));

      // Reset form
      $('#stallName,#foodName,#location,#reviewText').val('');
      $('#ratingVal').val(0); 
      $('#rating .star').removeClass('active');
      $('#preview').attr('src','').addClass('d-none');
      draftKeys.forEach(k => sessionStorage.removeItem('draft_' + k));

      $('#toast').fadeIn().delay(1500).fadeOut();
      renderReviews();
    });

    // -------------------- Clear Form --------------------
    $('#clearForm').on('click', function(){
      $('#stallName,#foodName,#location,#reviewText').val('');
      $('#ratingVal').val(0); 
      $('#rating .star').removeClass('active');
      $('#preview').attr('src','').addClass('d-none');
      draftKeys.forEach(k => sessionStorage.removeItem('draft_' + k));
    });

    // -------------------- Delete Review --------------------
    $('#reviews').on('click', '.button-delete', function(){
      const card = $(this).closest('.review-card');
      const id = Number(card.data('id'));
      if(!confirm('Delete this review?')) return;

      let list = JSON.parse(localStorage.getItem('reviews') || '[]');
      list = list.filter(r => r.id !== id);
      localStorage.setItem('reviews', JSON.stringify(list));
      renderReviews();
    });

    // -------------------- Image Modal --------------------
    $('#reviews').on('click', '.thumb', function(){
      $('#modalImg').attr('src', $(this).attr('src'));
      $('#imgModal').fadeIn();
    });

    $('.modal-close').on('click', () => $('#imgModal').fadeOut());
    $('#imgModal').on('click', e => { if(e.target.id === 'imgModal') $(e.target).fadeOut(); });

    // -------------------- Initial Render --------------------
    renderReviews();
  </script>

</body>
</html>
